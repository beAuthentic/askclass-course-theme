// _sass/_bubbles.scss
// Speech / chat bubbles with directional triangles
// Full expansion & refactoring for better SCSS usage

// ── 1. Theme colors (override in _base.scss or site variables if needed) ──
$color1:      lightyellow;     // left bubble bg
$color1h:     #ebebbb;         // left hover/active
$color1f:     #666658;         // left underline/accent

$color2:      lightgreen;      // right bubble bg
$color2h:     #6bd76b;         // right hover/active
$color2f:     #395f39;         // right underline/accent

$color-fade:  rgba(0,0,0,0.6); // border shadow

// Keep CSS vars for potential JS interop or legacy
:root {
  --color1:   #{$color1};
  --color1h:  #{$color1h};
  --color1f:  #{$color1f};
  --color2:   #{$color2};
  --color2h:  #{$color2h};
  --color2f:  #{$color2f};
  --colorFade: #{$color-fade};
}

// ── 2. Reusable triangle mixin ───────────────────────────────────────────────
@mixin triangle(
  $dir: left-in,
  $outer-size: 32px,
  $inner-size: 22px,
  $outer-color: $color1f,
  $inner-color: $color1
) {
  &:before,
  &:after {
    content: ' ';
    position: absolute;
    width: 0;
    height: 0;
    pointer-events: none;
  }

  &:before {
    border: $outer-size solid;
    border-color: $outer-color;
  }

  &:after {
    border: $inner-size solid;
    border-color: $inner-color;
  }

  @if $dir == 'left-in' {
    &:before {
      left: -40px; top: 12px;
      border-color: $outer-color $outer-color transparent transparent;
    }
    &:after {
      left: -20px; top: 20px;
      border-color: $inner-color $inner-color transparent transparent;
    }
  }

  @else if $dir == 'right-in' {
    &:before {
      right: -40px; top: 12px;
      border-color: $outer-color transparent transparent $outer-color;
    }
    &:after {
      right: -20px; top: 20px;
      border-color: $inner-color transparent transparent $inner-color;
    }
  }
}

// ── 3. Container ──────────────────────────────────────────────────────────────
.bubble-container {
  display: flex;

  &.left  { justify-content: flex-start; }
  &.right { justify-content: flex-end;   }
}

// ── 4. Bubble base ────────────────────────────────────────────────────────────
.talk-bubble {
  margin:     10px 35px;
  display:    inline-block;
  position:   relative;
  height:     auto;
  color:      #222;

  &.left {
    margin-right: 60px;
    background-color: $color1;

    a {
      color: inherit;
      background-color: $color1h;
    }
  }

  &.right {
    margin-left: 60px;
    background-color: $color2;

    a {
      color: inherit;
      background-color: $color2h;
    }
  }
}

// ── 5. Modifiers ──────────────────────────────────────────────────────────────
.border {
  border: 8px solid $color-fade;
}

.round {
  border-radius: 30px;
}

// ── 6. Triangles (using mixin) ────────────────────────────────────────────────
.tri-right {
  // left-in (slightly down)
  &.left-in {
    @include triangle(left-in, 20px, 12px, $color1f, $color1);

    &.border {
      @include triangle(left-in, 20px, 12px, $color1f, $color1);
    }
  }

  // right-in (slightly down)
  &.right-in {
    @include triangle(right-in, 20px, 12px, $color2f, $color2);

    &.border {
      @include triangle(right-in, 20px, 12px, $color2f, $color2);
    }
  }
}

// ── 7. Text content ───────────────────────────────────────────────────────────
.talktext {
  padding: 1em;
  text-align: left;
  font-family: var(--font-tertiary);

  // Responsive font sizing with clamp (modern replacement for calc)
  font-size:   clamp(20px, 1.25rem + 0.5vw, 30px);
  line-height: clamp(30px, 1.8rem + 0.8vw, 42px);

  .index {
    position: absolute;
    top: -14px;
    display: flex;
    width: 30px;
    font-size: 20px;
    line-height: 29px;
    white-space: nowrap;
    background-color: transparent;
  }

  .left & .index {
    color: $color1;
    left: -37px;
    justify-content: flex-end;
  }

  .right & .index {
    color: $color2;
    right: -37px;
    justify-content: flex-start;  // fixed typo from original
  }
}

// ── 8. Underlines ─────────────────────────────────────────────────────────────
u {
  text-decoration-thickness: from-font;
}

.left u  { text-decoration-color: $color1f; }
.right u { text-decoration-color: $color2f; }
